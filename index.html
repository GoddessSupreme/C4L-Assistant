<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cash4Life Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 40px auto;
      background: #f4f6f8;
      padding: 20px;
      color: #333;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      font-size: 14px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 15px;
      margin: 6px 4px 10px 0;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    .results, .dashboard {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    h2 {
      color: #007bff;
    }
  </style>
</head>
<body>

  <h1>🎲 Cash4Life Analyzer</h1>

  <textarea id="drawsInput" placeholder="6,19,20,22,57 + 4\n13,22,23,32,55 + 4"></textarea>
  <br>
  <button onclick="analyze()">Analyze</button>
  <button onclick="saveDraws()">💾 Save Locally</button>
  <button onclick="loadDraws()">📂 Load</button>
  <button onclick="clearDraws()">🗑️ Clear</button>
  <button onclick="downloadCSV()">⬇️ Export CSV</button>
  <button onclick="sendToGoogleSheets()">⬆️ Send to Google Sheets</button>

  <div class="results" id="results"></div>
  <div class="dashboard" id="dashboard">
    <h2>📈 Prediction Dashboard</h2>
    <p id="predictionMetrics">Run an analysis to view prediction statistics and trends here.</p>
  </div>

  <script>
    let mainStats = [], cashStats = [], suggestedNumbers = [], suggestedCash = 0;
    const endpoint = "https://script.google.com/macros/s/AKfycbziFjvRz_uKIcj9Jp1x7E_yN7wiZ84f1Kd3kKzUnpo6lT2SIvL8kllPNbmywanTuXPnYg/exec";

    function analyze() {
      const input = document.getElementById("drawsInput").value.trim();
      const lines = input.split("\n");
      const mainNumbers = [], cashBalls = [];

      lines.forEach(line => {
        const [main, cash] = line.split("+");
        if (!main || !cash) return;
        const nums = main.trim().split(",").map(n => parseInt(n.trim()));
        const cb = parseInt(cash.trim());
        if (nums.length === 5 && !nums.includes(NaN) && !isNaN(cb)) {
          mainNumbers.push(...nums);
          cashBalls.push(cb);
        }
      });

      if (mainNumbers.length === 0) {
        document.getElementById("results").innerHTML = "<p>Please enter valid draw data.</p>";
        return;
      }

      const countFreq = (arr) => {
        const map = {};
        arr.forEach(n => map[n] = (map[n] || 0) + 1);
        return Object.entries(map).sort((a, b) => b[1] - a[1]);
      };

      mainStats = countFreq(mainNumbers);
      cashStats = countFreq(cashBalls);

      const topMain = mainStats.slice(0, 15).map(([n]) => parseInt(n));
      suggestedCash = cashStats[0][0];

      suggestedNumbers = [];
      while (suggestedNumbers.length < 5) {
        const n = topMain[Math.floor(Math.random() * topMain.length)];
        if (!suggestedNumbers.includes(n)) suggestedNumbers.push(n);
      }
      suggestedNumbers.sort((a, b) => a - b);

      document.getElementById("results").innerHTML = `
        <h2>📊 Frequency Analysis</h2>
        <p><strong>Top 5 Most Frequent Main Numbers:</strong><br>${
          mainStats.slice(0, 5).map(([n, c]) => `${n} (${c})`).join(", ")
        }</p>
        <p><strong>Most Frequent Cash Ball:</strong> ${suggestedCash}</p>

        <h2>🎟️ Suggested Ticket</h2>
        <p><strong>Numbers:</strong> ${suggestedNumbers.join(", ")}<br>
        <strong>Cash Ball:</strong> ${suggestedCash}</p>
      `;

      document.getElementById("predictionMetrics").innerHTML = `
        <p><strong>Total Draws:</strong> ${lines.length}</p>
        <p><strong>Unique Main Numbers:</strong> ${[...new Set(mainNumbers)].length}</p>
        <p><strong>Unique Cash Balls:</strong> ${[...new Set(cashBalls)].length}</p>
      `;
    }

    function saveDraws() {
      const input = document.getElementById("drawsInput").value.trim();
      if (input) {
        localStorage.setItem("cash4life_draws", input);
        alert("Draws saved locally.");
      }
    }

    function loadDraws() {
      const saved = localStorage.getItem("cash4life_draws");
      if (saved) {
        document.getElementById("drawsInput").value = saved;
        alert("Draws loaded from storage.");
      } else {
        alert("No saved data found.");
      }
    }

    function clearDraws() {
      localStorage.removeItem("cash4life_draws");
      document.getElementById("drawsInput").value = '';
      document.getElementById("results").innerHTML = '';
      document.getElementById("dashboard").innerHTML = '';
      alert("Local data cleared.");
    }

    function downloadCSV() {
      if (!mainStats.length) {
        alert("Please analyze data first.");
        return;
      }

      let csv = "Main Number,Frequency\n";
      mainStats.forEach(([n, c]) => csv += `${n},${c}\n`);
      csv += "\nCash Ball,Frequency\n";
      cashStats.forEach(([n, c]) => csv += `${n},${c}\n`);
      csv += "\nSuggested Ticket\n";
      csv += "Main Numbers,Cash Ball\n";
      csv += `"${suggestedNumbers.join(", ")}",${suggestedCash}\n`;

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "cash4life_analysis.csv";
      a.click();
    }

    function sendToGoogleSheets() {
      const input = document.getElementById("drawsInput").value.trim();
      const lines = input.split("\n");

      lines.forEach(function(line) {
        const [main, cash] = line.split("+");
        if (!main || !cash) return;

        const nums = main.trim().split(",").map(n => parseInt(n.trim()));
        const cb = parseInt(cash.trim());

          const payload = {
            main_numbers: nums,
            cash_ball: cb,
            type: "manual",
            timestamp: new Date().toLocaleString()
          };

          fetch(https://script.google.com/macros/s/AKfycbziFjvRz_uKIcj9Jp1x7E_yN7wiZ84f1Kd3kKzUnpo6lT2SIvL8kllPNbmywanTuXPnYg/exec, {
            method: "POST",
            headers: { 
              "Content-Type": "application/json" 
          },
            body: JSON.stringify(data)
          })
          .then(response => response.text())
          .then(result => console.log("✅ Sent to Sheets:", result))
          .catch(error => console.error("❌ Error sending to Sheets:", error));
        }
      });

      alert("Draws sent to Google Sheets!");
    }
  </script>

</body>
</html>
